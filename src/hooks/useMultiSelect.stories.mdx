import { Meta, Description } from "@storybook/addon-docs";

import { getCategory } from "../utils/componentCategories";

<Meta title={getCategory("useMultiSelect")} />

# useMultiSelect

| Hook Version | DS Version |
| ------------ | ---------- |
| Added        | `1.1.0`    |
| Latest       | `1.1.0`    |

This custom hook, inspired by [downshift.js](https://www.downshift-js.com/),
exposes functions used for MultiSelect components. `useMultiSelect` provides all functions needed to handle the selectedItems. This hook can be used for
cases where managing the state of the component in the consuming app is less of a concern and general ease of use is prefered.

The two main functions are `onChange` and `onMixedStateChange` used for handling the selectedItems object. The third function provided by the hook, `onClear`,
can be used to reset the selectedItems of a individual MutliSelect component to an empty object. The hook also provides the `selectedItem` object containing the currently checked/selected
items of the MutlisSelect component.

## Usage

For a full implementation example, view the [`MultiSelectListbox` component](https://github.com/NYPL/nypl-design-system/blob/development/src/components/MultiSelect/MultiSelectListbox.tsx) or [`MultiSelectDialog` component](https://github.com/NYPL/nypl-design-system/blob/development/src/components/MultiSelect/MultiSelectDialog.tsx).

```tsx
const { onChange, onMixedStateChange, onClear, selectedItems } =
  useMultiSelect();
```

## useMultiSelect Hook implementation in a `listbox` MultiSelect

The `listbox` variant can only display non hierarchical items.
When the `useMultiSelect` hook is used within a `listbox` MultiSelect, you will only need the `onChange` and `onClear` functions and the selectedItems state.

```jsx
import React from "react";
import {
  MultiSelect,
  useMultiSelect,
} from "@nypl/design-system-react-components";

export default function MultiSelectWithHookExample() {
  const multiSelectId = "multi-select-1";
  // Without this hook, you'd have to add handlers for onChange and onClear,
  // and also manage the selectedItems state yourself.
  const { onChange, onClear, selectedItems } = useMultiSelect();

  return (
    <MultiSelect
      id={multiSelectId}
      variant="listbox"
      items={items}
      selectedItems={selectedItems}
      onChange={(e) => onChange(e.target.id, multiSelectId)}
      onClear={() => {
        onClear(multiSelectId);
      }}
    />
  );
}
```

## useMultiSelect Hook implementation in a `dialog` MultiSelect

The `dialog`variant can display nested items.
When the `useMultiSelect` hook is used within a `dialog` MultiSelect, additional to the selectedItems and the `onChange` and `onClear` functions, you will need
a `onMixedStateChange` function. It is also provided by the hook and handles the state change of parent items.

```jsx
import React from "react";
import {
  MultiSelect,
  useMultiSelect,
} from "@nypl/design-system-react-components";

export default function MultiSelectWithHookExample() {
  const multiSelectId = "multi-select-1";
  // Without this hook, you'd have to add handlers for onChange, onMixedStateChange and onClear,
  // and also manage the selectedItems state yourself.
  const { onChange, onMixedStateChange, onClear, selectedItems } =
    useMultiSelect();

  return (
    <MultiSelect
      id={multiSelectId}
      variant="dialog"
      items={items}
      selectedItems={selectedItems}
      onChange={(e) => onChange(e.target.id, multiSelectId)}
      onMixedStateChange={(e) =>
        onMixedStateChange(e.target.id, multiSelectId, items)
      }
      onClear={() => {
        onClear(multiSelectId);
      }}
    />
  );
}
```

## useMultiSelect Hook implementation in a `MultiSelectGroup`

The data structure used to render two `MultiSelect` components in the following `MultiSelectGroup` example:

```jsx
const multiSelectItems = [
  {
    id: "pets",
    name: "Pets",
    items: [
      { id: "cat", name: "Cat" },
      {
        id: "dog",
        name: "Dog",
        children: [
          { id: "corgy", name: "Corgy" },
          { id: "german-sheperd", name: "German Sheperd" },
          { id: "afghan-hound", name: "Afghan Hound" },
        ],
      },
      { id: "rat", name: "Rat" },
    ],
  },
  {
    id: "tools",
    name: "Tools",
    items: [
      { id: "hammer", name: "Hammer" },
      {
        id: "screwdriver",
        name: "Screwdriver",
        children: [
          { id: "slottet", name: "Slotted Screwdriver" },
          { id: "phillips", name: "Phillips Screwdriver" },
          { id: "allen", name: "Allen Screwdriver" },
        ],
      },
      { id: "whisk", name: "Whisk" },
    ],
  },
];
```

The implemntation of the `useMultiSelect` hook together with the `MultiSelectGroup` component.

```jsx
import React from "react";
import MultiSelectGroup from "./MultiSelectGroup";
import useMultiSelect from "./MultiSelect/useMultiSelect";

export default function MultiSelectGroupWithHookExample() {
  const { onChange, onMixedStateChange, onClear, selectedItems } =
    useMultiSelect();

  return (
    <MultiSelectGroup id="multiselect-group" labelText="MultiSelect Group">
      {multiSelectItems &&
        multiSelectItems.map((multiSelect) => (
          <MultiSelect
            key={multiSelect.id}
            id={multiSelect.id}
            label={multiSelect.name}
            variant="dialog"
            items={multiSelect.items}
            selectedItems={selectedItems}
            onChange={(e) => {
              onChange(e.target.id, multiSelect.id);
            }}
            onMixedStateChange={(e) =>
              onMixedStateChange(e.target.id, multiSelect.id, multiSelect.items)
            }
            onClear={() => {
              onClear(multiSelect.id);
            }}
            onApply={() => {}}
          />
        ))}
    </MultiSelectGroup>
  );
  );
}
```
