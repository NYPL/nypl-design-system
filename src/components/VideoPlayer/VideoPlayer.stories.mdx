import { action } from "@storybook/addon-actions";
import {
  ArgsTable,
  Canvas,
  Description,
  Meta,
  Story,
} from "@storybook/addon-docs";
import { withDesign } from "storybook-addon-designs";

import VideoPlayer from "./VideoPlayer";
import { VideoPlayerAspectRatios, VideoPlayerTypes } from "./VideoPlayerTypes";
import { getCategory } from "../../utils/componentCategories";
import DSProvider from "../../theme/provider";
import { getStorybookEnumValues } from "../../utils/utils";

export const ratiosEnumValues = getStorybookEnumValues(
  VideoPlayerAspectRatios,
  "VideoPlayerAspectRatios"
);
export const typesEnumValues = getStorybookEnumValues(
  VideoPlayerTypes,
  "VideoPlayerTypes"
);

<Meta
  title={getCategory("VideoPlayer")}
  component={VideoPlayer}
  decorators={[withDesign]}
  parameters={{
    design: {
      type: "figma",
      url: "https://www.figma.com/file/qShodlfNCJHb8n03IFyApM/Main?node-id=10968%3A3680",
    },
    jest: ["VideoPlayer.test.tsx"],
  }}
  argTypes={{
    aspectRatio: {
      control: { type: "select" },
      table: {
        defaultValue: { summary: "VideoPlayerAspectRatios.SixteenByNine" },
      },
      options: ratiosEnumValues.options,
    },
    className: { control: false },
    id: { control: false },
    showHelperInvalidText: {
      table: { defaultValue: { summary: true } },
    },
    videoType: {
      control: { type: "select" },
      options: typesEnumValues.options,
    },
  }}
/>

# Video Player

| Component Version | DS Version |
| ----------------- | ---------- |
| Added             | `0.23.2`   |
| Latest            | `0.25.9`   |

<Description of={VideoPlayer} />

The `VideoPlayer` component is used to embed a `Vimeo` or `YouTube` video player on a page. The component requires the `embedCode` prop or both the `videoType` and `videoId` props. The component will not function properly if you try to set all of them.

You can extract the videoId from the video's URL. **IMPORTANT:** Do not try to enter the full video URL as the `videoId` value.

The `aspectRatio` prop is used to control the sizing of the space allotted for the video rendering. Ultimately, the `aspectRatio` prop should be set to match the aspect ratio of the video that is being rendered. The default aspect ratio is `16:9`.

<Canvas withToolbar>
  <Story
    name="VideoPlayer"
    args={{
      aspectRatio: "VideoPlayerAspectRatios.SixteenByNine",
      className: undefined,
      descriptionText:
        "Fusce dapibus, tellus ac cursus commodo, tortor mauris condimentum nibh, ut fermentum massa justo sit amet risus. Cum sociis natoque penatibus et magnis dis parturient montes, nascetur ridiculus mus.",
      embedCode: `<iframe src="https://player.vimeo.com/video/421404144?h=5467db7edd" width="640" height="360" frameborder="0" allow="autoplay; fullscreen; picture-in-picture" allowfullscreen></iframe>`,
      headingText: "NYPL Video",
      helperText:
        "Lorem ipsum dolor sit amet, consectetur adipiscing elit. Vivamus sagittis lacus vel augue laoreet rutrum faucibus dolor auctor.",
      id: "videoPlayer-id",
      iframeTitle: undefined,
      showHelperInvalidText: true,
      videoId: undefined,
      videoType: undefined,
    }}
  >
    {(args) => (
      <VideoPlayer
        {...args}
        aspectRatio={ratiosEnumValues.getValue(args.aspectRatio)}
        embedCode={args.embedCode}
        videoType={args.videoType && typesEnumValues.getValue(args.videoType)}
      />
    )}
  </Story>
</Canvas>

<ArgsTable story="VideoPlayer" />

**Example Vimeo IDs:** `474719268`, `491405018`, `493795778` (square)<br />
**Example YouTube IDs:** `PfqgDG1qrKg`, `roi5V8ppi7Y`, `nm-dD2tx6bk`

## Extracting Video IDs

### Vimeo

```
https://vimeo.com/[VIDEO_ID]
https://vimeo.com/474719268
```

### YouTube

```
https://www.youtube.com/watch?v=[VIDEO_ID]
https://www.youtube.com/watch?v=nm-dD2tx6bk
```

## Example Embed Code Snippets

The examples below are shown with precise HTML formatting. However, often the embed code snippets provided by 3rd party video services are delivered as one long string.

### Vimeo

```html
<iframe
  src="https://player.vimeo.com/video/421404144?h=5467db7edd"
  width="640"
  height="360"
  frameborder="0"
  allow="autoplay; fullscreen; picture-in-picture"
  allowfullscreen
></iframe>
```

### YouTube

```html
<iframe
  width="560"
  height="315"
  src="https://www.youtube.com/embed/nm-dD2tx6bk"
  title="YouTube video player"
  frameborder="0"
  allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
  allowfullscreen
></iframe>
```

## Errored

If the necessary props are not passed to the `VideoPlayer` component, the component UI will display an error message.

<Canvas>
  <DSProvider>
    <VideoPlayer
      videoId="https://vimeo.com/474719268"
      videoType={VideoPlayerTypes.Vimeo}
    />
  </DSProvider>
</Canvas>

## HTML in Helper Text

It's possible to include HTML in the `helperText` prop.

<Canvas>
  <DSProvider>
    <VideoPlayer
      helperText="This helper text <b>contains HTML</b>."
      videoId="474719268"
      videoType={VideoPlayerTypes.Vimeo}
    />
  </DSProvider>
</Canvas>
