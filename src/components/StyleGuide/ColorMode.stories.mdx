import { Box } from "@chakra-ui/react";
import { Canvas, Meta } from "@storybook/addon-docs";

import { getCategory } from "../../utils/componentCategories";
import DSProvider from "../../theme/provider";

<Meta title={getCategory("Color Mode")} />

# Color Mode

## Table of Contents

- [General Information](#general-information)
- [Accessibility Guidelines](#accessibility-guidelines)
- [Toggling Color Mode](#toggling-color-mode)
- [Using Local Storage to Manage Color Mode](#using-local-storage-to-manage-color-mode)

## General Information

_NOTE: The color mode functionality in the Reservoir Design System is currently
in development and not all components have been updated to support various color
modes such as dark mode._

Color mode in the Reservoir Design System (DS) allows components to support
different color schemes, specifically light and dark modes. These schemes can
also be defined by users through their system preferences but the DS will
default to its light mode configuration for the time being.

All of the information below can be found on Chakra UI's [Color Mode](https://v1.chakra-ui.com/docs/styled-system/features/color-mode)
documentation page. The guideline and examples below have been updated to reflect
its usage with the Reservoir Design System.

## Accessibility Guidelines

All DS components support light mode and have gone through color contrast
accessibility review. Not all DS components have been updated to support dark
mode, so there could be accessibility issues when using it. Therefore, for the
time being, we don't recommend using dark mode.

If dark mode is required, there are ways to pass color mode-dependent styles
to DS components which will be discussed in the next sections. Make sure that
the passed styles are accessible for both light and dark mode.

Resources:

- [WebAIM Contrast Checker](https://webaim.org/resources/contrastchecker/)
- [W3 WAI Colors with Good Contrast](https://www.w3.org/WAI/perspective-videos/contrast/)
- [The A11y Project - Operating System and Browser Accessibility Display Modes](https://www.a11yproject.com/posts/operating-system-and-browser-accessibility-display-modes/)

## Toggling Color Mode

### useColorMode

The `useColorMode` hook is provided by Chakra to allow managing the color mode
in an application. This hook is also exported by the DS. Invoking `useColorMode`
will return an object with the following properties:

- `colorMode` is the current color mode of the application as "light" or "dark".
- `toggleColorMode` is a function that can be used to toggle the color mode.

Note that the `useColorMode` hook must be used inside of the `DSProvider`. If you
call it outside of the provider, `colorMode` will return a value of `undefined`.

```tsx
import { Button, useColorMode } from "@nypl/design-system-react-components";

const ToggleColorModeButton = () => {
  const { colorMode, toggleColorMode } = useColorMode();

  return (
    <>
      <p>The current color mode is {colorMode}</p>
      <Button id="toggleButton" onClick={toggleColorMode}>
        Toggle Color Mode
      </Button>
    </>
  );
};
```

### useColorModeValue

The `useColorModeValue` hook is provided by Chakra to allow setting style values
based on the app's color mode. This hook is also exported by the DS. The two
arguments passed to `useColorModeValue` are the light mode value and the dark
mode value. This hook does _not_ update the app's color mode; it returns the
appropriate value based on the current color mode.

As an example, let's make the `Heading` component color mode aware:

```tsx
import { Heading, useColorModeValue } from "@nypl/design-system-react-components";

const AppPage = () => {
  const lightModeValue = "ui.black";
  const darkModeValue = "ui.white";
  const headingColor = useColorModeValue(lightModeValue, darkModeValue);

  return (
    <Heading level={1} color={headingColor}>
  );
};
```

## Using Local Storage to Manage Color Mode

### ColorModeScript

This component is used to sync local storage correctly for the apps's color mode.
This should be added in the app's `body` tag before all the content.

#### Basic App Example

This example is based on using Parcel for bundling and running the app but it
will work for any basic front-end app architecture. Code shorten for brevity.

```tsx
// src/index.tsx
import { ColorModeScript } from "@nypl/design-system-react-components";
import { App } from "./components/App";

const app = document.getElementById("app");
ReactDOM.render(
  <>
    <ColorModeScript />
    <App />
  </>,
  app
);
```

#### Next.js App Example

The `ColorModeScript` component should be added in the `_document.tsx` file.

```tsx
// pages/_document.js
import { ColorModeScript } from "@nypl/design-system-react-components";
import { Html, Head, Main, NextScript } from "next/document";

const Document = () => {
  const initialColorMode = "light";
  render() {
    return (
      <Html lang="en">
        <Head />
        <body>
          <ColorModeScript initialColorMode={initialColorMode} />
          <Main />
          <NextScript />
        </body>
      </Html>
    );
  }
};

export default Document;
```

### colorModeManager

This is a prop in the `DSProvider` component. It is most helpful for server-side
rendering and is based on local storage and browser's cookies. This is optional
but is useful for apps that need to render in a specific color mode on the server
to avoid rerendering the user-specified color mode on the client.

The value is set through the `cookieStorageManager` function if cookies are
found or else the `localStorageManager` default value.

#### Next.js App Example

```tsx
// pages/_app.tsx
import {
  cookieStorageManager,
  DSProvider,
  localStorageManager,
  useColorModeValue,
} from "@nypl/design-system-react-components";
import type { AppProps } from "next/app";

function MyApp({ Component, pageProps }: AppProps) {
  // ...
  const colorModeManager =
    typeof pageProps.cookies === "string"
      ? cookieStorageManager(pageProps.cookies)
      : localStorageManager;

  return (
    <>
      // ...
      <DSProvider colorModeManager={colorModeManager}>
        <Component {...pageProps} />
      </DSProvider>
    </>
  );
}

export function getServerSideProps({ req }: any) {
  return {
    props: {
      // First time users will not have any cookies and you may not return
      // undefined here, hence `??` is necessary.
      cookies: req.headers.cookie ?? "",
    },
  };
}
```

<!-- hack to make sure correct styles are used on the page -->

<DSProvider />
