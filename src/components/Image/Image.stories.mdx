import { VStack } from "@chakra-ui/react";
import {
  ArgsTable,
  Canvas,
  Description,
  Meta,
  Story,
} from "@storybook/addon-docs";
import { withDesign } from "storybook-addon-designs";

import Heading from "../Heading/Heading";
import Image from "./Image";
import SimpleGrid from "../Grid/SimpleGrid";
import { getCategory } from "../../utils/componentCategories";

export const imageBlockStyles = {
  margin: "auto",
  maxWidth: "360px",
  textAlign: "center",
  width: "100%",
};

<Meta
  title={getCategory("Image")}
  component={Image}
  decorators={[withDesign]}
  parameters={{
    design: {
      type: "figma",
      url: "https://www.figma.com/file/qShodlfNCJHb8n03IFyApM/Master?node-id=11896%3A45379",
    },
    jest: ["Image.test.tsx"],
  }}
  argTypes={{
    additionalFigureStyles: { control: false },
    additionalImageStyles: { control: false },
    additionalWrapperStyles: { control: false },
    alt: {
      control: false,
      description:
        "Alternate text description of the image. Needed for accessibility purposes.",
    },
    aspectRatio: {
      table: { defaultValue: { summary: "original" } },
    },
    className: {
      control: false,
      description: "Additional class name for the component to use.",
    },
    component: { control: false },
    imageType: {
      table: { defaultValue: { summary: "default" } },
    },
    size: {
      table: { defaultValue: { summary: "default" } },
    },
    src: {
      description:
        "The src attribute is required, and contains the path to the image you want to embed.",
    },
  }}
/>

# Image

| Component Version | DS Version |
| ----------------- | ---------- |
| Added             | `0.0.6`    |
| Latest            | `1.0.7`    |

## Table of Contents

- [Overview](#overview)
- [Component Props](#component-props)
- [Accessibility](#accessibility)
- [Image Figure](#image-figure)
- [Image Sizes](#image-sizes)
- [Image Aspect Ratios](#image-aspect-ratios)
- [Image Types](#image-types)
- [Lazy Loading](#lazy-loading)

## Overview

<Description of={Image} />

If you want a simple HTML `img` element then don't pass in values for the
`aspectRatio` or `size` props.

## Component Props

<Canvas>
  <Story
    name="Image with Controls"
    args={{
      additionalFigureStyles: undefined,
      additionalImageStyles: undefined,
      additionalWrapperStyles: undefined,
      alt: "Alt text",
      aspectRatio: "twoByOne",
      caption: "Image caption",
      className: undefined,
      component: undefined,
      credit: "Image credit",
      imageType: "default",
      size: "medium",
      src: "https://placeimg.com/400/300/animals",
    }}
  >
    {(args) => <Image {...args} />}
  </Story>
</Canvas>

<ArgsTable story="Image with Controls" />

## Accessibility

All images must have an `alt` attribute, even if it's empty. The `alt` prop should
be used to concisely describe the image. If the image is decorative, then the
`alt` prop should be an empty string `""`.

Resources:

- [W3C WAI Images Tutorial](https://www.w3.org/WAI/tutorials/images/)
- [WebAIM Accessible Images](https://webaim.org/techniques/images/)
- [Yale Usability & Web Accessibility](https://usability.yale.edu/web-accessibility/articles/images)

## Image Figure

By passing in `credit` or `caption`, the `Image` component will
render an HTML `figure` element and render an `img` element inside with the
proper props. If no `credit` or `caption` prop values are passed,
then an `img` element will be rendered with or without wrapper style divs.

<Canvas>
  <Story
    name="Figure and figcaption"
    args={{
      alt: "Alt text",
      aspectRatio: "threeByTwo",
      caption: "Image caption",
      credit: "Image credit",
      imageType: "default",
      size: "medium",
      src: "https://placeimg.com/400/300/animals",
    }}
    argTypes={{
      aspectRatio: { table: { disable: true } },
      caption: { table: { disable: true } },
      credit: { table: { disable: true } },
      imageType: { table: { disable: true } },
      size: { table: { disable: true } },
      src: { table: { disable: true } },
    }}
  >
    {(args) => <Image {...args} />}
  </Story>
</Canvas>

## Image Sizes

Use the `size` prop to set the desired size with the `ImageSizes` enum.

<Canvas>
  <Story name="Image Sizes">
    <SimpleGrid columns={1}>
      <div style={{ textAlign: "center" }}>
        <Heading id="ExtraExtraSmall" level="four" text="xxsmall" />
        <Image
          alt="Alt text"
          caption="64px"
          size="xxsmall"
          src="https://placeimg.com/400/300/animals"
        />
      </div>
      <div style={{ textAlign: "center" }}>
        <Heading id="ExtraSmall" level="four" text="xsmall" />
        <Image
          alt="Alt text"
          caption="96px"
          size="xsmall"
          src="https://placeimg.com/400/300/animals"
        />
      </div>
      <div style={{ textAlign: "center" }}>
        <Heading id="Small" level="four" text="small" />
        <Image
          alt="Alt text"
          caption="165px"
          size="small"
          src="https://placeimg.com/400/300/animals"
        />
      </div>
      <div style={{ textAlign: "center" }}>
        <Heading id="Medium" level="four" text="medium" />
        <Image
          alt="Alt text"
          caption="225px"
          size="medium"
          src="https://placeimg.com/400/300/animals"
        />
      </div>
      <div style={{ textAlign: "center" }}>
        <Heading id="Large" level="four" text="large" />
        <Image
          alt="Alt text"
          caption="360px"
          size="large"
          src="https://placeimg.com/400/300/animals"
        />
      </div>
      <div style={{ textAlign: "center" }}>
        <Heading id="Default" level="four" text="default" />
        <Image
          alt="Alt text"
          caption="100%"
          src="https://placeimg.com/400/300/animals"
        />
      </div>
    </SimpleGrid>
  </Story>
</Canvas>

## Image Aspect Ratios

Use the `aspectRatio` prop to set the desired aspect ratio. Note: the
following example has `size` set to `ImageSizes.Small`.

For a better viewing experience, the `Image` components below have been wrapped
in an element with a fixed width value.

<Canvas>
  <Story name="Image Aspect Ratios">
    <SimpleGrid columns={1}>
      <div style={imageBlockStyles}>
        <Heading id="fourbythree" level="four" text="fourByThree" />
        <Image
          alt="Alt text"
          aspectRatio="fourByThree"
          src="https://placeimg.com/400/300/animals"
        />
      </div>
      <div style={imageBlockStyles}>
        <Heading id="onebytwo" level="four" text="oneByTwo" />
        <Image
          alt="Alt text"
          aspectRatio="oneByTwo"
          src="https://placeimg.com/400/300/animals"
        />
      </div>
      <div style={imageBlockStyles}>
        <Heading id="original" level="four" text="original" />
        <Image
          alt="Alt text"
          aspectRatio="original"
          src="https://placeimg.com/400/300/animals"
        />
      </div>
      <div style={imageBlockStyles}>
        <Heading id="sixteenbynine" level="four" text="sixteenByNine" />
        <Image
          alt="Alt text"
          aspectRatio="sixteenByNine"
          src="https://placeimg.com/400/300/animals"
        />
      </div>
      <div style={imageBlockStyles}>
        <Heading id="square" level="four" text="square" />
        <Image
          alt="Alt text"
          aspectRatio="square"
          src="https://placeimg.com/400/300/animals"
        />
      </div>
      <div style={imageBlockStyles}>
        <Heading id="threebyfour" level="four" text="threeByFour" />
        <Image
          alt="Alt text"
          aspectRatio="threeByFour"
          src="https://placeimg.com/400/300/animals"
        />
      </div>
      <div style={imageBlockStyles}>
        <Heading id="threebytwo" level="four" text="threeByTwo" />
        <Image
          alt="Alt text"
          aspectRatio="threeByTwo"
          src="https://placeimg.com/400/300/animals"
        />
      </div>
      <div style={imageBlockStyles}>
        <Heading id="twobyone" level="four" text="twoByOne" />
        <Image
          alt="Alt text"
          aspectRatio="twoByOne"
          src="https://placeimg.com/400/300/animals"
        />
      </div>
    </SimpleGrid>
  </Story>
</Canvas>

## Image Types

Use the `imageType` prop to get an image variant. Note that to get a perfect
circle, the `aspectRatio` prop _must_ be set to `"square"`.

For a better viewing experience, the `Image` components below have been wrapped
in an element with a fixed width value.

<Canvas>
  <Story name="Image Types">
    <SimpleGrid columns={1}>
      <div style={imageBlockStyles}>
        <Heading id="default" level="four" text="default" />
        <Image
          alt="Alt text"
          aspectRatio="square"
          imageType="default"
          src="https://placeimg.com/400/400/animals"
        />
      </div>
      <div style={imageBlockStyles}>
        <Heading id="circle" level="four" text="circle" />
        <Image
          alt="Alt text"
          aspectRatio="square"
          imageType="circle"
          src="https://placeimg.com/400/400/animals"
        />
      </div>
    </SimpleGrid>
  </Story>
</Canvas>

## Lazy Loading

The `Image` component handles lazy loading images through two npm packages:
[`react-intersection-observer`](https://github.com/thebuilder/react-intersection-observer)
and [`@charlietango/use-native-lazy-loading`](https://www.npmjs.com/package/@charlietango/use-native-lazy-loading).
The first package handles using the `IntersectionObserver` API in React and the
second package checks if the `img`'s native `loading="lazy"` attribute is
supported by the browser.

Lazy loading is disabled by default. In order to use the lazy loading feature,
pass the `isLazy` prop or set it to `true`.

```jsx
<Image alt="Alt text" isLazy src="https://placeimg.com/540/420/animals" />
```

The `Image`'s implementation of lazy loading is based on the recipe provided by
`react-intersection-observer`. Once the image's wrapper is in view, we load the
image by rendering it through the native `loading="lazy"` attribute or through
the `IntersectionObserver` API.

In the following example, open the "Network" tab in your browser's console and
as you scroll down to view the next set of 10 images, you'll see that they get
loaded as the images come into the window's view.

Resources:

- [Browser-level image lazy-loading for the web](https://web.dev/browser-level-image-lazy-loading/)

<Canvas>
  <Story name="Lazy Loading">
    <SimpleGrid columns={1}>
      <Image alt="Alt text" isLazy src="https://placeimg.com/540/420/animals" />
      <Image alt="Alt text" isLazy src="https://placeimg.com/500/400/animals" />
      <Image alt="Alt text" isLazy src="https://placeimg.com/460/460/animals" />
      <Image alt="Alt text" isLazy src="https://placeimg.com/420/490/animals" />
      <Image alt="Alt text" isLazy src="https://placeimg.com/200/120/animals" />
      <Image alt="Alt text" isLazy src="https://placeimg.com/640/340/animals" />
      <Image alt="Alt text" isLazy src="https://placeimg.com/460/480/animals" />
      <Image alt="Alt text" isLazy src="https://placeimg.com/100/200/animals" />
      <Image alt="Alt text" isLazy src="https://placeimg.com/400/400/animals" />
      <Image alt="Alt text" isLazy src="https://placeimg.com/250/360/animals" />
    </SimpleGrid>
  </Story>
</Canvas>
