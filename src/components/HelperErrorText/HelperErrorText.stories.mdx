import {
  ArgsTable,
  Canvas,
  Description,
  Meta,
  Story,
} from "@storybook/addon-docs";
import { withDesign } from "storybook-addon-designs";

import HelperErrorText from "./HelperErrorText";
import Link from "../Link/Link";
import Text from "../Text/Text";
import { getCategory } from "../../utils/componentCategories";
import DSProvider from "../../theme/provider";

<Meta
  title={getCategory("HelperErrorText")}
  component={HelperErrorText}
  decorators={[withDesign]}
  parameters={{
    design: {
      type: "figma",
      url: "",
    },
    jest: ["HelperErrorText.test.tsx"],
  }}
  argTypes={{
    ariaAtomic: {
      control: false,
      table: { defaultValue: { summary: true } },
    },
    ariaLive: {
      table: { defaultValue: { summary: "polite" } },
    },
    children: { table: { disable: true } },
    className: { control: false },
    id: { control: false },
    isInvalid: {
      table: { defaultValue: { summary: false } },
    },
  }}
/>

# HelperErrorText

| Component Version | DS Version |
| ----------------- | ---------- |
| Added             | `0.0.10`   |
| Latest            | `1.0.6`    |

## Table of Contents

- [Overview](#overview)
- [Component Props](#component-props)
- [Accessibility](#accessibility)
- [With HTML Children](#with-html-children)
- [Invalid State](#invalid-state)

## Overview

<Description of={HelperErrorText} />

## Component Props

<Canvas withToolbar>
  <Story
    name="HelperErrorText with Controls"
    args={{
      ariaAtomic: undefined,
      ariaLive: "polite",
      className: undefined,
      id: "helperErrorText-id",
      isInvalid: false,
      text: "This is the helper text!",
    }}
  >
    {(args) => (
      <HelperErrorText
        {...args}
        text={args.isInvalid ? "This is the error text :(" : args.text}
      />
    )}
  </Story>
</Canvas>

<ArgsTable story="HelperErrorText with Controls" />

## Accessibility

In the "invalid" state when `isInvalid` is set to true, the text passed to the
`invalidText` prop will be presented to screen readers be default. If you need
to turn this off, set the `ariaLive` prop to `"off"`. This is used in DS "form"
components for invalid form submissions or incorrect values entered.

### ariaAtomic

The `ariaAtomic` prop sets the `aria-atomic` attribute and it is set to `true`
by default. This allows the entire DOM element to be presented to assistive
technologies. When it is set to `false`, only additionals or removals will be
read by assistive technologies.

### ariaLive

The `ariaLive` prop sets the `aria-live` attribute; `"polite"` is set by default
in the "invalid" state and `"off"` otherwise. This sets the priority of when the
text in this component should be read to users by assistive technologies. The
`"off"` value indicates that the content should not be presented, `"polite"` that
it will be announced at the next available time slot, and `"assertive"` that it
should be announced immediately.

<Canvas>
  <Story
    name="With Aria Controls"
    args={{
      ariaAtomic: true,
      ariaLive: "polite",
      isInvalid: true,
    }}
  >
    {(args) => (
      <HelperErrorText
        {...args}
        text="Only invalid text can be read to screen readers with the appropriate aria-atomic and aria-live props."
      />
    )}
  </Story>
</Canvas>

Resources:

- [MDN ARIA live regions](https://developer.mozilla.org/en-US/docs/Web/Accessibility/ARIA/ARIA_Live_Regions)
- [W3C WAI-ARIA 1.1 - aria-live (property)](https://www.w3.org/TR/wai-aria-1.1/#aria-live)
- [W3C ARIA19: Using ARIA role=alert or Live Regions to Identify Errors](https://www.w3.org/TR/WCAG20-TECHS/ARIA19.html)
- [DigitalA11y WAI-ARIA:aria-live (Property)](https://www.digitala11y.com/aria-live-properties/)

## With HTML Children

The `HelperErrorText` component can render any React component or HTML element
through the `text` prop.

<Canvas>
  <Story name="With HTML Children">
    <HelperErrorText
      text={
        <>
          This first example uses an HTML anchor element for{" "}
          <a href="#">a link</a>.
        </>
      }
    />
    <HelperErrorText
      text={
        <Text>
          This second example uses Reservoir Design System (DS) components, such
          as the <Link href="#">`Link`</Link> component, and the `Text`
          component.
        </Text>
      }
    />
  </Story>
</Canvas>

## Invalid State

Set the `isInvalid` prop to `true` to render the passed text in the
NYPL "invalid" styling.

<Canvas>
  <Story name="Invalid State">
    <HelperErrorText isInvalid text="This is the error text :(" />
  </Story>
</Canvas>
