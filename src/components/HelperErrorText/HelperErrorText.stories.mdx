import {
  ArgsTable,
  Canvas,
  Description,
  Meta,
  Story,
} from "@storybook/addon-docs";
import { withDesign } from "storybook-addon-designs";

import HelperErrorText from "./HelperErrorText";
import Link from "../Link/Link";
import Text from "../Text/Text";
import TextInput from "../TextInput/TextInput";
import { getCategory } from "../../utils/componentCategories";
import DSProvider from "../../theme/provider";

<Meta
  title={getCategory("HelperErrorText")}
  component={HelperErrorText}
  decorators={[withDesign]}
  parameters={{
    design: {
      type: "figma",
      url: "",
    },
    jest: ["HelperErrorText.test.tsx"],
  }}
  argTypes={{
    ariaAtomic: {
      control: false,
      table: { defaultValue: { summary: true } },
    },
    ariaLive: {
      table: { defaultValue: { summary: "polite" } },
    },
    children: { table: { disable: true } },
    className: { control: false },
    id: { control: false },
    isInvalid: {
      table: { defaultValue: { summary: false } },
    },
    isRenderedText: {
      table: { defaultValue: { summary: false } },
    },
  }}
/>

# HelperErrorText

| Component Version | DS Version |
| ----------------- | ---------- |
| Added             | `0.0.10`   |
| Latest            | `1.4.1`    |

## Table of Contents

- [Overview](#overview)
- [Component Props](#component-props)
- [Accessibility](#accessibility)
- [With HTML Children](#with-html-children)
- [Invalid State](#invalid-state)

## Overview

<Description of={HelperErrorText} />

## Component Props

<Canvas withToolbar>
  <Story
    name="HelperErrorText with Controls"
    args={{
      ariaAtomic: undefined,
      ariaLive: undefined,
      className: undefined,
      id: "helperErrorText-id",
      isInvalid: false,
      text: "This is the helper text!",
    }}
  >
    {(args) => (
      <HelperErrorText
        {...args}
        text={args.isInvalid ? "This is the error text :(" : args.text}
      />
    )}
  </Story>
</Canvas>

<ArgsTable story="HelperErrorText with Controls" />

## Accessibility

In the Reservoir Design System (DS), the `HelperErrorText` component is always
used as a child component when composing more complex components.

In the case of form components, the `HelperErrorText` component is associated
with a related input field by using the `aria-describedby` attribute in the
associated element. This pattern ensures that the content of the `HelperErrorText`
component is made available to screenreaders.

This component will always render at least an empty `<div>` element even if no
text content is passed. This is to ensure that the accessibility guideline for
dynamic content is met. One expected use case of the `HelperErrorText` component
is to dynamically render error text when a form field is invalid. In that
scenario, the dynamically updated error text will be read by assistive
technologies.

The example below is shows a `TextInput` component. The `TextInput` component
uses the `HelperErrorText` component to render the red-colored `"This is error text :("` text below the input field and that text element is referenced with
the `aria-describedby` attribute on the HTML input element. This type of
association is handled automatically by all DS `Form Elements` components.

<Canvas>
  <Story
    name="Text Input with HelperErrorText"
    args={{
      helperText: "Choose wisely.",
      id: "textInput-id",
      invalidText: "This is error text :(",
      isInvalid: true,
      labelText: "What is your favorite color?",
      name: "textInput-name",
      placeholder: "e.g. blue, green, etc.",
    }}
  >
    {(args) => <TextInput {...args} />}
  </Story>
</Canvas>

### ariaAtomic

The `ariaAtomic` prop sets the `aria-atomic` HTMl attribute. This allows the
entire DOM element to be presented to assistive technologies. When it is set to
`false`, only additions or removals will be read by assistive technologies.

By default, this prop is set to `true`.

### ariaLive

The `ariaLive` prop sets the `aria-live` HTML attribute. This determines the
priority of when text updates in this component should be read to users by
assistive technologies. The possible values are the same as the native HTML
`aria-live` attribute: `"off"`, `"polite"`, and `"assertive"`.

The `"off"` value indicates that updates should not be announced and when this
value is passed, the `aria-live` attribute will not be added at all. The
`"polite"` value indicates that updates will be announced at the next available
time slot. The `"assertive"` value indicates that updates should be announced
immediately, but this is not recommended as it can interruptive to the user.

In order to meet the accessibility guidelines for dynamic content updates, this
attribute is set in the wrapper `<div>` element that is always rendered by the
`HelperErrorText` component.

By default, this prop is set to `"polite"`.

<Canvas>
  <Story
    name="With Aria Controls"
    args={{
      ariaAtomic: true,
      ariaLive: "polite",
    }}
  >
    {(args) => (
      <HelperErrorText
        {...args}
        text="Live updates to the helper and error text can be read to screen readers with the appropriate aria-atomic and aria-live props."
      />
    )}
  </Story>
</Canvas>

Resources:

- [MDN aria-describedby Attribute](https://developer.mozilla.org/en-US/docs/Web/Accessibility/ARIA/Attributes/aria-describedby)
- [MDN ARIA live regions](https://developer.mozilla.org/en-US/docs/Web/Accessibility/ARIA/ARIA_Live_Regions)
- [W3C WAI-ARIA 1.1 - aria-live (property)](https://www.w3.org/TR/wai-aria-1.1/#aria-live)
- [W3C ARIA19: Using ARIA role=alert or Live Regions to Identify Errors](https://www.w3.org/TR/WCAG20-TECHS/ARIA19.html)
- [DigitalA11y WAI-ARIA:aria-live (Property)](https://www.digitala11y.com/aria-live-properties/)

## With HTML Children

The `HelperErrorText` component can render any React component or HTML element
through the `text` prop.

<Canvas>
  <Story name="With HTML Children">
    <HelperErrorText
      text={
        <>
          This first example uses an HTML anchor element for{" "}
          <a href="#">a link</a>.
        </>
      }
    />
    <HelperErrorText
      text={
        <Text>
          This second example uses Reservoir Design System (DS) components, such
          as the <Link href="#">`Link`</Link> component, and the `Text`
          component.
        </Text>
      }
    />
  </Story>
</Canvas>

## Invalid State

Set the `isInvalid` prop to `true` to render the passed text content with the
NYPL "invalid" styling.

<Canvas>
  <Story name="Invalid State">
    <HelperErrorText isInvalid text="This is the error text :(" />
  </Story>
</Canvas>
