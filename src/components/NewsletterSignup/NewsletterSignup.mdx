import { ArgTypes, Canvas, Description, Meta, Source } from "@storybook/blocks";

import * as NewsletterSignupStories from "./NewsletterSignup.stories";
import Link from "../Link/Link";

<Meta of={NewsletterSignupStories} />

# NewsletterSignup

| Component Version | DS Version   |
| ----------------- | ------------ |
| Added             | `Prerelease` |
| Latest            | `Prerelease` |

## Table of Contents

- {<Link href="#overview" target="_self">Overview</Link>}
- {<Link href="#component-props" target="_self">Component Props</Link>}
- {<Link href="#accessibility" target="_self">Accessibility</Link>}

## Overview

<Description of={NewsletterSignupStories} />

## Component Props

<Canvas of={NewsletterSignupStories.WithControls} />

<ArgTypes of={NewsletterSignupStories.WithControls} />

## Accessibility

The `NewsletterSignup` component is a complex component built from various Reservoir
DS and Chakra components.

Within the `NewsletterSignup` component, the DS `form` component wraps around two DS `FormField` components.
Those`FormField` components hold a DS `TextInput` component of `type="email"` and a DS `Button` component of `type="submit"` respectively.
Each of these components has their own accessibility features documented in their respective Storybook pages.

When the form is submitted, focus is set to the confirmation message or the
error message if an error occurs.

Resources:

- [DS Form Accessibility](../?path=/docs/components-form-elements-form--docs#accessibility)
- [DS Button Accessibility](../?path=/docs/components-form-elements-button--docs#accessibility)
- [DS TextInput Accessibility](../?path=/docs/components-form-elements-textinput--docs#accessibility)

## JSX Elements passed to descriptionText Prop

Alternatively to a `descriptionText` of type `string`, a HTML Element or React component can be passed. When passing a JSX Element, the consuming app is responsible
to assure its accessibility.

_NOTE: This is applicable for all component props excepting HTML/JSX elements._

<Canvas of={NewsletterSignupStories.DescriptionUsingJSXElements} />

## Form Submission Data

Submitted form data can be retrieved when the `NewsletterSignup` component is
submitted through the required `onSubmit` prop. This prop expects a function and
it will be called when the form is submitted. Similar to other DS form-components
that have function props, the data from the component will be returned in the
function's argument. In this case, it will be a single object.

The submitted form data will be passed as an object that the parent component
can use. The returned object will always contain the "email" field.

Below is an example callback function named `onSubmit` that is passed to the
`NewsletterSignup` component's `onSubmit` prop and how the view is controlled
in the data submission process. The form data will be returned through
the function's argument as an object, called `values` in the example below.

<Source 
  code={`
const [view, setView] = React.useState("form");
const onSubmit = async (values) => {
  e.preventDefault();
  setView("submitting");
  const endpoint = "...";
  //Form the request for sending data to the server.
  const options = {
    method: "POST",
    headers: {Content-Type: "application/json"},
    body: JSON.stringify(values),
  };
  //Send the form and await response.
  try {
    const response = await fetch(endpoint, options);
    const result = await response.json();
    setView("confirmation");
  } catch (error) {
    setView("error");
  }
};

//....

<NewsletterSignup onChange={onChange} onSubmit={onSubmit} view={view} />

`}
language="jsx"
/>

## Component States

<Canvas of={NewsletterSignupStories.ComponentStates} />
