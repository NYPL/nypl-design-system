import {
  Meta,
  Story,
  Canvas,
  ArgsTable,
  Description,
} from "@storybook/addon-docs/blocks";
import { withDesign } from "storybook-addon-designs";
import {
  BrowserRouter as Router,
  Link as ReactRouterLink,
} from "react-router-dom";
import { VStack } from "@chakra-ui/react";

import Link from "./Link";
import { LinkTypes } from "./LinkTypes";
import Icon from "../Icons/Icon";
import { IconAlign, IconNames, IconSizes } from "../Icons/IconTypes";
import { getCategory } from "../../utils/componentCategories";
import DSProvider from "../../theme/provider";

<Meta
  title={getCategory("Link")}
  component={Link}
  decorators={[withDesign]}
  parameters={{
    design: {
      type: "figma",
      url: "https://www.figma.com/file/qShodlfNCJHb8n03IFyApM/Main?node-id=36854%3A24387",
    },
    jest: ["Link.test.tsx"],
  }}
  argTypes={{
    attributes: { table: { disable: true } },
    children: { table: { disable: true } },
    type: {
      control: {
        type: "select",
      },
      options: LinkTypes,
    },
  }}
/>

# Link

| Component Version | DS Version |
| ----------------- | ---------- |
| Added             | `0.0.4`    |
| Latest            | `0.25.9`   |

<Description of={Link} />

<Canvas withToolbar>
  <Story
    name="Basic"
    args={{
      id: "nypl-link",
      type: LinkTypes.Action,
      href: "https://nypl.org",
      className: "custom-class",
      attributes: {
        rel: "nofollow",
        onClick: (e) => e.preventDefault(),
      },
    }}
  >
    {(args) => <Link {...args}>Link</Link>}
  </Story>
</Canvas>

<ArgsTable story="Basic" />

## Links With Icons

To render an `Icon` as part of the link, make sure that the `Link` component
wraps the `Icon`. Use `type={LinkTypes.Action}` to apply appropriate styling to
links with icons. Icons can be rendered to the left or right of the link text.

<Canvas>
  <Story name="With Icons">
    <VStack spacing="xs" align="flex-start">
      <Link type={LinkTypes.Action} href="#passed-in-link">
        <Icon name="headset" align={IconAlign.Left} size={IconSizes.Small} />
        Headset Link
      </Link>
      <Link type={LinkTypes.Action} href="#passed-in-link">
        <Icon name="clock" align={IconAlign.Left} size={IconSizes.Small} />
        Clock Link
      </Link>
      <Link type={LinkTypes.Action} href="#passed-in-link">
        <Icon
          name={IconNames.Check}
          align={IconAlign.Left}
          size={IconSizes.Small}
        />
        Check Link
      </Link>
      <Link type={LinkTypes.Action} href="#passed-in-link-right">
        Check Link Right
        <Icon
          name={IconNames.Check}
          align={IconAlign.Right}
          size={IconSizes.Small}
        />
      </Link>
    </VStack>
  </Story>
</Canvas>

## Anchor Element Rendering

`Link` can wrap an existing `<a>` element (and `Icon` component) or it
can use the `href` prop to generate an `<a>` element.

```jsx
// Existing anchor element
<Link type={LinkTypes.Action}>
  <a href="#existing-anchor-tag">link</a>
</Link>

// Also works with an icon component. Make sure to wrap the icon and anchor
// in a single element for this pattern.
<Link type={LinkTypes.Action}>
  <>
    <Icon name={IconNames.Check} align={IconAlign.Left} size={IconSizes.Small} />
    <a href="#existing-anchor-tag">check link</a>
  </>
</Link>

// Otherwise, the `href` prop will generate an `<a>` tag.
<Link type={LinkTypes.Action} href="#passed-in-link">
  link
</Link>
```

<Canvas>
  <Story name="Anchor Element Rendering">
    <>
      This is a{" "}
      <Link type={LinkTypes.Action}>
        <a href="#existing-anchor-tag">link</a>
      </Link>{" "}
      with the &lt;a&gt; element as a child of the `Link` component. This is a{" "}
      <Link type={LinkTypes.Action} href="#passed-in-link">
        link
      </Link>{" "}
      where the `Link` component uses the `href` prop and has a string-only
      child. Finally, this is a{" "}
      <Link type={LinkTypes.Action}>
        <>
          <Icon
            name={IconNames.Check}
            align={IconAlign.Left}
            size={IconSizes.Small}
          />
          <a href="#existing-anchor-tag">link</a>
        </>
      </Link>{" "}
      with a check icon.
    </>
  </Story>
</Canvas>

## Link with Routers

<Canvas>
  <Story name="Link with Routers">
    <div>With React Router</div>
    <Router>
      <Link type={LinkTypes.Action}>
        <ReactRouterLink to="#">Next Page</ReactRouterLink>
      </Link>
    </Router>
    <br />
    <br />
    <div>With NextJS</div>
    <NextJsLink href="#" passHref>
      <Link type={LinkTypes.Action}>Next Page</Link>
    </NextJsLink>
  </Story>
</Canvas>

### React Router

The Design System's `Link` component should wrap around `react-router`'s own
`Link` component. To avoid name conflicts, rename either the Design System's
or `react-router`'s `Link` component. Any of the following patterns are valid.

```jsx
// In this first example, React Router's `Link` component
// is renamed as `ReactRouterLink`.
import {
  BrowserRouter as Router,
  Link as ReactRouterLink,
} from "react-router-dom";
import { Link, LinkTypes } from "@nypl/design-system-react-components";

<Link type={LinkTypes.Action}>
  <ReactRouterLink to="#">Next Page</ReactRouterLink>
</Link>;

// In this second example, React Router's `Link` component
// is not renamed but the DS's `Link` component is renamed
// to `DSLink`.
import { BrowserRouter, Link } from "react-router-dom";
import {
  Link as DSLink,
  LinkTypes,
} from "@nypl/design-system-react-components";

<DSLink type={LinkTypes.Action}>
  <Link to="#">Next Page</Link>
</DSLink>;

// In this third example, React Router's `Link` component
// is not renamed and the DS's `Link` component is
// imported and rendered as `DS.Link`.
import { BrowserRouter, Link } from "react-router-dom";
import DS from "@nypl/design-system-react-components";

<DS.Link type={DS.LinkTypes.Action}>
  <Link to="#">Next Page</Link>
</DS.Link>;
```

<Canvas>
  <DSProvider>
    <Router>
      <Link type={LinkTypes.Action}>
        <ReactRouterLink to="#">Next Page</ReactRouterLink>
      </Link>
    </Router>
  </DSProvider>
</Canvas>

### NextJS

NextJS's `Link` component should wrap the Design System's `Link` component.
The `href` and `passHref` props MUST be passed into NextJS' `Link` component.
These props, along with an implicit `ref` from NextJS and the Design System's
`Link` component `forwardRef` implementation, handle correctly routing between
pages in a NextJS app.

```jsx
import { Link, LinkTypes } from "@nypl/design-system-react-components";

/**
 * This is just an example wrapper that works similarly to NextJS' `Link`
 * component. In real life, NextJS's `Link` component will pass down the
 * `href` and `passHref` props and a `ref` to make routing functional.
 */
export const NextJsLink = (props: HTMLAnchorElement) =>
  React.cloneElement(
    props.children,
    { ...props },
    props.children.props.children
  );

// Note that NextJS' `href` and `passHref` props are required.
<NextJsLink href="#" passHref>
  <Link type={LinkTypes.Action}>Next Page</Link>
</NextJsLink>;
```

export const NextJsLink = (props) =>
  React.cloneElement(
    props.children,
    { ...props },
    props.children.props.children
  );

<Canvas>
  <DSProvider>
    <NextJsLink href="#" passHref>
      <Link type={LinkTypes.Action}>Next Page</Link>
    </NextJsLink>
  </DSProvider>
</Canvas>
