import { VStack } from "@chakra-ui/react";
import {
  ArgsTable,
  Canvas,
  Description,
  Meta,
  Story,
} from "@storybook/addon-docs";
import {
  BrowserRouter as Router,
  Link as ReactRouterLink,
} from "react-router-dom";
import { withDesign } from "storybook-addon-designs";

import Link from "./Link";
import { LinkTypes } from "./LinkTypes";
import Icon from "../Icons/Icon";
import { IconAlign, IconSizes } from "../Icons/IconTypes";
import { getCategory } from "../../utils/componentCategories";
import DSProvider from "../../theme/provider";
import { getStorybookEnumValues } from "../../utils/utils";

export const enumValues = getStorybookEnumValues(LinkTypes, "LinkTypes");

<Meta
  title={getCategory("Link")}
  component={Link}
  decorators={[withDesign]}
  parameters={{
    design: {
      type: "figma",
      url:
        "https://www.figma.com/file/qShodlfNCJHb8n03IFyApM/Main?node-id=36854%3A24387",
    },
    jest: ["Link.test.tsx"],
  }}
  argTypes={{
    additionalStyles: { control: false },
    attributes: { control: false },
    children: { table: { disable: true } },
    type: {
      control: { type: "select" },
      options: enumValues.options,
    },
  }}
/>

# Link

| Component Version | DS Version |
| ----------------- | ---------- |
| Added             | `0.0.4`    |
| Latest            | `0.25.1`   |

<Description of={Link} />

<Canvas withToolbar>
  <Story
    name="Link with Controls"
    args={{
      attributes: {
        rel: "nofollow",
        onClick: (e) => e.preventDefault(),
      },
      className: "custom-class",
      href: "https://nypl.org",
      id: "nypl-link",
      type: "LinkTypes.Action",
    }}
    argTypes={{
      type: {
        control: { type: "select" },
        table: { defaultValue: { summary: "LinkTypes.Default" } },
        options: enumValues.options,
      },
    }}
  >
    {(args) => (
      <Link {...args} type={enumValues.getValue(args.type)}>
        Link
      </Link>
    )}
  </Story>
</Canvas>

<ArgsTable story="Link with Controls" />

## Links With Icons

To render an `Icon` as part of the link, make sure that the `Link` component
wraps the `Icon`. Use `type={LinkTypes.Action}` to apply appropriate styling to
links with icons. Icons can be rendered to the left or right of the link text.

<Canvas>
  <Story name="With Icons">
    <VStack spacing="xs" align="flex-start">
      <Link type={LinkTypes.Action} href="#passed-in-link">
        <Icon name="headset" align={IconAlign.Left} size={IconSizes.Small} />
        Headset Link
      </Link>
      <Link type={LinkTypes.Action} href="#passed-in-link">
        <Icon name="clock" align={IconAlign.Left} size={IconSizes.Small} />
        Clock Link
      </Link>
      <Link type={LinkTypes.Action} href="#passed-in-link">
        <Icon name="check" align={IconAlign.Left} size={IconSizes.Small} />
        Check Link
      </Link>
      <Link type={LinkTypes.Action} href="#passed-in-link-right">
        Check Link Right
        <Icon name="check" align={IconAlign.Right} size={IconSizes.Small} />
      </Link>
    </VStack>
  </Story>
</Canvas>

## Anchor Element Rendering

`Link` can wrap an existing `<a>` tag or it can use the `href` prop to generate
an `<a>` tag.

<Canvas>
  <Story name="Anchor Element Rendering">
    <>
      This is a{" "}
      <Link type={LinkTypes.Action}>
        <a href="#existing-anchor-tag">link</a>
      </Link>{" "}
      with the &lt;a&gt; tag as a child of the Link component. And this is a{" "}
      <Link type={LinkTypes.Action} href="#passed-in-link">
        link
      </Link>{" "}
      where the Link component uses the `href` prop and has a string-only child.
    </>
  </Story>
</Canvas>

## Link with Routers

<Canvas>
  <Story name="Link with Routers">
    <div>With React Router</div>
    <Router>
      <Link type={LinkTypes.Action}>
        <ReactRouterLink to="#">Next Page</ReactRouterLink>
      </Link>
    </Router>
    <br />
    <br />
    <div>With NextJS</div>
    <NextJsLink href="#" passHref>
      <Link type={LinkTypes.Action}>Next Page</Link>
    </NextJsLink>
  </Story>
</Canvas>

### React Router

The Design System's `Link` component should wrap around `react-router`'s own
`Link` component. To avoid name conflicts, rename either the Design System's
or `react-router`'s `Link` component.

```jsx
import {
  BrowserRouter as Router,
  Link as ReactRouterLink,
} from "react-router-dom";
import { Link, LinkTypes } from "@nypl/design-system-react-components";

<Link type={LinkTypes.Action}>
  <ReactRouterLink to="#">Next Page</ReactRouterLink>
</Link>;

// or

import { BrowserRouter, Link } from "react-router-dom";
import {
  Link as DSLink,
  LinkTypes,
} from "@nypl/design-system-react-components";

<DSLink type={LinkTypes.Action}>
  <Link to="#">Next Page</Link>
</DSLink>;

// or

import { BrowserRouter, Link } from "react-router-dom";
import DS from "@nypl/design-system-react-components";

<DS.Link type={DS.LinkTypes.Action}>
  <Link to="#">Next Page</Link>
</DS.Link>;
```

<Canvas>
  <DSProvider>
    <Router>
      <Link type={LinkTypes.Action}>
        <ReactRouterLink to="#">Next Page</ReactRouterLink>
      </Link>
    </Router>
  </DSProvider>
</Canvas>

### NextJS

NextJS's `Link` component should wrap the Design System's `Link` component.
The `href` and `passHref` props MUST be passed into NextJS' `Link` component.
These props, along with an implicit `ref` from NextJS and the Design System's
`Link` component `forwardRef` implementation, handle correctly routing between
pages in a NextJS app.

```jsx
import { Link, LinkTypes } from "@nypl/design-system-react-components";

/* This is just an example wrapper that works similarly to NextJS' `Link`
 * component. In real life, NextJS's `Link` component will pass down the
 * `href` and `passHref` props and a `ref` to make routing functional.
 */
export const NextJsLink = (props: HTMLAnchorElement) => (
  <div>
    {React.cloneElement(
      props.children,
      { ...props },
      props.children.props.children
    )}
  </div>
);

<NextJsLink href="#" passHref>
  <Link type={LinkTypes.Action}>Next Page</Link>
</NextJsLink>;
```

export const NextJsLink = (props) => (
  <div>
    {React.cloneElement(
      props.children,
      { ...props },
      props.children.props.children
    )}
  </div>
);

<Canvas>
  <DSProvider>
    <NextJsLink href="#" passHref>
      <Link type={LinkTypes.Action}>Next Page</Link>
    </NextJsLink>
  </DSProvider>
</Canvas>
