import { Meta } from "@storybook/addon-docs";

import { getCategory } from "../../utils/componentCategories";
import DSProvider from "../../theme/provider";

<Meta title={getCategory("Dynamic Content")} />

# Dynamic Content

## Table of Contents

- [General Information](#general-information)
- [ARIA Live Regions](#aria-live-regions)
- [Anti-Patterns](#anti-patterns)
- [NYPL Patterns](#nypl-patterns)
- [Resources](#resources)

## General Information

Most websites have elements on the page that are updated dynamically. For these
scenarios, it should be clear to the user what the changes are and where the
changes will take place. Typically, the update is indicated by displaying a visual
loading animation before the new content is displayed. For most able-bodied users,
this is usually not a problem but for users who use assistive technology, we
need to make sure that the changes are understood and announced by the assistive
technology.

The quick takeaway for implementing this necessary functionality is to _always_
render an empty container for the dynamic content in the DOM on the server-side.
The container element should have an `aria-live="polite"` attribute applied. The
following example shows one possible DOM structure that allows newly generated
content to be recognized and announced by assistive technology.

```html
<div class="dynamic-content-container" aria-live="polite">
  <!-- Any dynamic content should be inserted, removed, or updated here. -->
</div>
```

## ARIA Live Regions

The `aria-live` attribute is used to indicate that an element's content will be
updated dynamically and that it should be announced to assistive technology.
The `aria-live` attribute can be set to "off", "polite", or "assertive". _When_
the content should be read by the assistant technology depends which of the three
values is use. This attribute does not manage focus on the element.

_Always include the `aria-live` attribute for dynamic content in the initial DOM
render to allow assistive technology to track the updates for the specified
element._

- `aria-live="off"` - the default value which is the same as not having the
  attribute at all.
- `aria-live="polite"` - the screen reader will wait until the user is done
  interacting with the page before announcing the change. This is usually the
  best option for dynamic content.
- `aria-live="assertive"` - the screen reader will announce the change
  immediately, even if the user is in the middle of interacting with the page.
  This should be used sparingly when the update is time-sensitive or critical
  because it can be disruptive to the user.

## ARIA Atomic

The `aria-atomic` attribute is used to indicate whether assistive technology
should announce the entire content or only the changes. This is useful when an
element's entire content is not replaced on every update but all of the content
should still be read.

- `aria-atomic="true"` - the entire content of the element will be read by the
  assistive technology.
- `aria-atomic="false"` - only the changes to the content will be read by the
  assistive technology.

For example, if the content of an element is updated to "Results found: 5" and
then updated again to "Results found: 10", the assistive technology will announce
"10" when `aria-atomic="false"` but will announce "Results found: 10" when
`aria-atomic="true"`.

```html
<div class="dynamic-content-container" aria-live="polite" aria-atomic="true">
  Results found:
  <span class="dynamic-content">
    <!-- Any dynamic content should be inserted, removed, or updated here. -->
  </span>
</div>
```

## Anti-Patterns

**Do not dynamically add or remove the `aria-live` attribute from the element.**

The `aria-live` attribute should be set on the element when the page is rendered.
The following is **incorrect**:

```html
<div id="dynamic-content-container">
  <!-- Any dynamic content should be inserted, removed, or updated here. -->
</div>
```

```js
const container = document.getElementById("dynamic-content-container");
container.setAttribute("aria-live", "polite");
```

**Do not assign the `aria-live` attribute to an entire section or the
entire page.**

Add the `aria-live` attribute to the specific element that will be updated. For
example, on a search results page that updates the amount of results found and
the list of results, only add the `aria-live` attribute to the element that
contains the number of results. The following is not recommended:

```html
<div id="search-results" aria-live="polite">
  <div id="results-count">
    <!-- Dynamic content. -->
    <span>10 results found</span>
  </div>
  <ul id="results-list">
    <!-- Dynamic list of li elements. -->
    <li>
      <p>Title: Result 1</p>
      <p>Author: Author 1</p>
    </li>
    <li>
      <p>Title: Result 2</p>
      <p>Author: Author 2</p>
    </li>
    <!-- ... -->
  </ul>
</div>
```

This is not recommended because the screen reader will announce:

```
"10 results found Title: Result 1 Author: Author 1 Title: Result 2 Author: Author 2 ..."
```

This is information overload. Instead, add the `aria-live` attribute to the
element that contains the updated number of results found. In this case, it's
the element with `id` of `results-count` only.

## NYPL Patterns

### HelperErrorText

The `HelperErrorText` component renders an empty `div` element with the
`aria-live` attribute set to `"polite"` by default. This element can be used to
display content that is dynamically updated through the `text` prop. This
component should not be conditionally rendered on the page. Instead, the content
should be dynamically updated.

```jsx
// Very naive example.
const [text, setText] = useState("");

useEffect(() => {
  setText("This helper text was dynamically updated.");
}, []);

// Even though `text` is empty by default, the `HelperErrorText` component
// is still rendered. The text that is dynamically updated will be announced
// by assistive technology.
return <HelperErrorText text={text} />;
```

### TextInput

The `TextInput` component internally implements the `HelperErrorText` component
to display helper or error text. This is especially useful when there is an error
that needs to be displayed after the user has interacted with the input.

In the following example, the helper text "Please enter a 5-digit value." is set
by default. If the user does not enter a 5-digit value, the error text "The zip
code needs to be 5-digits." is displayed _and_ also announced by assistive
technology.

```jsx
// Very naive example.
const [inputValue, setInputValue] = useState();

return (
  <TextInput
    labelText="Zip code example"
    isInvalid={inputValue.length !== 5}
    onChange={(e) => setInputValue(e.target.value)}
    helperText="Please enter a 5-digit value."
    invalidText="The zip code needs to be 5-digits."
    value={inputValue}
  />
);
```

## Resources

- [MDN aria-live](https://developer.mozilla.org/en-US/docs/Web/Accessibility/ARIA/Attributes/aria-live)
- [W3 WAI-ARIA: aria-live](https://www.w3.org/TR/wai-aria/#aria-live)
- [MDN ARIA live regions](https://developer.mozilla.org/en-US/docs/Web/Accessibility/ARIA/ARIA_Live_Regions)

<!-- hack to make sure correct styles are used on the page -->

<DSProvider />
