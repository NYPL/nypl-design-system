import {
  Meta,
  Story,
  ArgsTable,
  Canvas,
  Description,
} from "@storybook/addon-docs/blocks";
import { withDesign } from "storybook-addon-designs";

import SearchBar from "./SearchBar";
import * as stories from "../Autosuggest/Autosuggest.stories.tsx";
import { getCategory } from "../../utils/componentCategories";
import DSProvider from "../../theme/provider";

<Meta
  title={getCategory("SearchBar")}
  component={SearchBar}
  decorators={[withDesign]}
  parameters={{
    design: {
      type: "figma",
      url:
        "https://www.figma.com/file/qShodlfNCJHb8n03IFyApM/Master?node-id=11689%3A423",
    },
    jest: ["SearchBar.test.tsx"],
  }}
  argTypes={{
    action: { table: { disable: true } },
    ariaLabel: { table: { disable: true } },
    buttonOnClick: { table: { disable: true } },
    className: { table: { disable: true } },
    id: { table: { disable: true } },
    method: { table: { disable: true } },
    onSubmit: { table: { disable: true } },
    selectProps: { table: { disable: true } },
    textInputProps: { table: { disable: true } },
    textInputElement: { table: { disable: true } },
  }}
/>

# SearchBar

| Component Version | DS Version |
| ----------------- | ---------- |
| Added             | `0.0.4`    |
| Latest            | `0.25.3`   |

<Description of={SearchBar} />

The main wrapper element that is rendered is a `<form>` DOM element. All the
props passed to `SearchBar` will apply to the `<form>` element and its children.
The `SearchBar` component will render a `Select` component (optional),
`TextInput` component, `Button` component, and `HelperErrorText` component
based on the required props.

The `Select` dropdown narrows the search within a specific category, typically
title or author. Toggle the `Select` through the Controls.

export const optionsGroup = [
  "Art",
  "Bushes",
  "Clothing",
  "Flowers",
  "Fossils",
  "Fruits",
  "Furniture",
  "Songs",
  "Tools",
  "Villagers",
];

<Canvas withToolbar>
  <Story
    name="Basic"
    args={{
      showHelperText: true,
      showSelect: true,
      invalidText: "Could not find the item :(",
      isDisabled: false,
      isInvalid: false,
      isRequired: false,
      helperErrorText: "Search for items in Animal Crossing New Horizons",
    }}
  >
    {(args) => (
      <SearchBar
        onSubmit={() => {}}
        {...args}
        selectProps={
          args.showSelect && {
            name: "nhItemSearch",
            labelText: "Select a category",
            optionsData: optionsGroup,
          }
        }
        textInputProps={{
          labelText: "Item Search",
          placeholder: "Item Search",
        }}
        helperErrorText={args.showHelperText && args.helperErrorText}
      />
    )}
  </Story>
</Canvas>

<ArgsTable story="Basic" />

## Component Props

### Select Component

To render an optional `Select` component, an object must be passed to the
`selectProps` prop. It _must_ include `name`, `labelText`, and `optionsData`
properties. The `labelText` value won't be rendered but will be used for its
`aria-label` attribute.

```
const selectProps = {
  name: "select-form-name",
  labelText: "Select a category",
  optionsData: optionsGroup,
};

// ...
<SearchBar
  onSubmit={() => {}}
  selectProps={selectProps}
  // ...
/>
```

### TextInput Component

To render the `TextInput` component, an object must be passed to the
`textInputProps` prop. It _must_ include `labelText` and `placeholder`
properties. The `labelText` value won't be rendered but will be used for its
`aria-label` attribute.

```
const textInputProps = {
  labelText: "Item Search",
  placeholder: "Item Search",
};

// ...
<SearchBar
  onSubmit={() => {}}
  textInputProps={textInputProps}
  // ...
/>
```

### Custom Input Component

To render a custom input component, pass the component to the `textInputElement`
prop. This will render your custom input component such as an `Autocomplete`
component. Check the "Search Autocomplete" example for more details.

```
const textInputElement = <CustomInput {...props} />;

// ...
<SearchBar
  onSubmit={() => {}}
  textInputElement={textInputElement}
  // ...
/>
```

### Button Component

A `Button` component will automatically be rendered for the `SearchBar`
component. If you want to pass a callback function to the `Button`, use the
`buttonOnClick` prop.

### HelperErrorText Component

To render the `HelperErrorText` component, pass a string value to the
`helperErrorText` prop. For the invalid state when `isInvalid` is true, pass the
error string in the `invalidText` prop.

```
const helperErrorText = "";

// ...
<SearchBar
  onSubmit={() => {}}
  helperErrorText="Search for items in Animal Crossing New Horizons"
  // ...
/>
```

## Search Autocomplete

While the Design System does not implement an `Autosuggest` or `Autocomplete`
component, it does show a pattern for using the `react-autosuggest` package.
In this example, we're using the `react-autosuggest` example found in the
[Basic Autosuggest story](https://nypl.github.io/nypl-design-system/storybook-static/?path=/story/autosuggest--autosuggest-library)
as the main component inside the `SearchBar` component.

In order to render this custom input element in the `SearchBar` component, pass
it in the `textInputElement` prop. Do not pass an object to the `textInputProps`
prop since the custom input component passed in `textInputElement` will take
precedence.

<Canvas withToolbar>
  <Story
    name="Search Autocomplete"
    args={{
      isInvalid: false,
      isDisabled: false,
      isRequired: false,
    }}
  >
    {(args) => (
      <div style={{ minHeight: "150px" }}>
        <SearchBar
          onSubmit={() => {}}
          textInputElement={stories.SearchBarExample()}
          helperErrorText="Select your home library. Start by typing the name of the library. Try 'ba'."
          {...args}
        />
      </div>
    )}
  </Story>
</Canvas>

## Other Examples

Use the Controls in the `Basic` example to see different states in real time.
Here are the same possible states of the `SearchBar` component in static examples.

### Error State

For the error state, set the `isInvalid` prop to `true`. This will update the
state for all its children. If you passed a custom input element, you must
handle the error state yourself.

<Canvas>
  <DSProvider>
    <SearchBar
      onSubmit={() => {}}
      textInputProps={{
        labelText: "Item Search",
        placeholder: "Item Search",
      }}
      helperErrorText="Sorry, we can't find that item!"
      invalidText="Could not find the item :("
      isInvalid
    />
  </DSProvider>
</Canvas>

### Disabled State

For the disabled state, set the `isDisabled` prop to `true`. This will update
the state for all its children. If you passed a custom input element, you must
handle the disabled state yourself.

<Canvas>
  <DSProvider>
    <SearchBar
      obSubmit={() => {}}
      textInputProps={{
        labelText: "Item Search",
        placeholder: "Item Search",
      }}
      helperErrorText="Reason for disabled state."
      isDisabled
    />
  </DSProvider>
</Canvas>
