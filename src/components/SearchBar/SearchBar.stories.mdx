import {
  Meta,
  Story,
  ArgsTable,
  Canvas,
  Description,
} from "@storybook/addon-docs/blocks";
import { withDesign } from "storybook-addon-designs";

import SearchBar from "./SearchBar";
import Select from "../Select/Select";
import HelperErrorText from "../HelperErrorText/HelperErrorText";
import Button from "../Button/Button";
import { ButtonTypes } from "../Button/ButtonTypes";
import Icon from "../Icons/Icon";
import { IconNames } from "../Icons/IconTypes";
import TextInput from "../TextInput/TextInput";
import { TextInputTypes } from "../TextInput/TextInputTypes";
import * as stories from "../Autosuggest/Autosuggest.stories.tsx";
import { getCategory } from "../../utils/componentCategories";
import DSProvider from "../../theme/provider";

<Meta
  title={getCategory("SearchBar")}
  component={SearchBar}
  decorators={[withDesign]}
  parameters={{
    design: {
      type: "figma",
      url:
        "https://www.figma.com/file/qShodlfNCJHb8n03IFyApM/Master?node-id=11689%3A423",
    },
    jest: ["SearchBar.test.tsx"],
  }}
  argTypes={{
    action: { table: { disable: true } },
    ariaLabel: { table: { disable: true } },
    className: { table: { disable: true } },
    id: { table: { disable: true } },
    method: { table: { disable: true } },
    onSubmit: { table: { disable: true } },
  }}
/>

# SearchBar

<Description of={SearchBar} />

The main wrapper element that is rendered is `<form>` DOM element. All the props
passed to `SearchBar` will apply to the `<form>` element. If you need to update
the children, make sure the props are passed to the appropriate components.

The `Select` dropdown narrows the search within a specific category, typically
title or author. You should only have one `Select` component at a time. If you
need more options, link to the advance search page. Toggle the `Select` through
the Controls.

_Note: The `HelperErrorText` component should be the next direct sibling of the
`SearchBar` component if it will be used._

export const optionsGroup = {
  Art: [
    "Academic Painting",
    "Amazing Painting",
    "Ancient Statue",
    "Basic Painting",
    "Beautiful Statue",
  ],
  Bushes: [
    "Blue-Hydrangea Bush",
    "Blue-Hydrangea Start",
    "Holly Bush",
    "Orange-Tea-Olive Bush",
    "Pink Camellia Bush",
  ],
  Clothing: ["3D Glasses", "Academy Uniform", "Acid-Washed Jacket"],
  "DIY Recipes": ["Acorn Pochette", "Acoustic Guitar", "Angled Signpost"],
  Flowers: [
    "Black Cosmos",
    "Blue Pansies",
    "Gold Roses",
    "Lily of the Valley",
    "Orange Hyacinth",
  ],
  Fossils: [
    "Acanthostega",
    "Amber",
    "Ammonite",
    "Ankylo Skull",
    "Anomalocaris",
    "Australopith",
  ],
  Fruits: ["Apples", "Oranges", "Pears", "Coconuts", "Cherries"],
  Furniture: [
    "Abstract Wall",
    "Accessories Stand",
    "ACNH Switch",
    "Air Circulator",
  ],
  Materials: [
    "Acorn",
    "Aquaris Fragment",
    "Bamboo Piece",
    "Boot",
    "Clump of Weeds",
  ],
  NPC: ["Celeste", "Kicks", "Leif", "Redd", "Saharah"],
  Songs: ["Agent K.K.", "Caf√© K.K.", "Comrade K.K."],
  Tools: [
    "Axe",
    "Bamboo Wand",
    "Fishing Rod",
    "Shovel",
    "Slingshot",
    "Watering Can",
  ],
  Villagers: ["Agnes", "Alfonso", "Anchovy", "Axel", "Aurora"],
};

<Canvas withToolbar>
  <Story
    name="Basic"
    args={{
      showHelperText: true,
      showSelect: true,
      isInvalid: false,
      isDisabled: false,
      isRequired: false,
    }}
  >
    {(args) => (
      <SearchBar onSubmit={() => {}} {...args}>
        {args.showSelect && (
          <Select id="select-searchBar" name="nhItemSearch">
            {Object.keys(optionsGroup).map((nhOption) => (
              <option key={nhOption} value={nhOption}>
                {nhOption}
              </option>
            ))}
          </Select>
        )}
        <TextInput
          id="inputBasic"
          labelText="Item Search"
          placeholder="Item Search"
          type={TextInputTypes.text}
        />
        <Button id="buttonBasic" buttonType={ButtonTypes.Primary} type="submit">
          <Icon
            name={IconNames.search}
            decorative={true}
            modifiers={["small", "icon-left"]}
          />
          Search
        </Button>
        {args.showHelperText && (
          <HelperErrorText id="error-disabled">
            Search for items in Animal Crossing New Horizons
          </HelperErrorText>
        )}
      </SearchBar>
    )}
  </Story>
</Canvas>

<ArgsTable story="Basic" />

## Search Autocomplete

While the Design System does not implement an `Autosuggest` or `Autocomplete`
component, it does show a pattern for using the `react-autosuggest` package.
In this example, we're using the `react-autosuggest` example found in the
[Basic Autosuggest story](https://nypl.github.io/nypl-design-system/storybook-static/?path=/story/autosuggest--autosuggest-library)
as the main component inside the `SearchBar` component. See the combination of
the Autosuggest story along with this story to see how to compose all the
components together.

<Canvas withToolbar>
  <Story
    name="Search Autocomplete"
    args={{
      isInvalid: false,
      isDisabled: false,
      isRequired: false,
    }}
  >
    {(args) => (
      <div style={{ minHeight: "150px" }}>
        <SearchBar onSubmit={() => {}} {...args}>
          {stories.SearchBarExample()}
          <Button
            buttonType={ButtonTypes.Primary}
            id="autosuggest-button"
            type="submit"
          >
            <Icon
              name={IconNames.search}
              decorative={true}
              modifiers={["small", "icon-left"]}
            />
            Search
          </Button>
          <HelperErrorText id="autosuggest-helperText">
            Select your home library. Start by typing the name of the library.
            Try {'"'}ba{'"'}.
          </HelperErrorText>
        </SearchBar>
      </div>
    )}
  </Story>
</Canvas>

## Other Examples

Use the Controls in the `Basic` example to see different states in real time.
Here are the same possible states of the `SearchBar` component in static examples.

### Error State

For the error state, make sure that the `errored` prop is passed to the `Input`
component and the `isError` prop is passed to the `HelperErrorText` component.

<Canvas>
  <DSProvider>
    <SearchBar obSubmit={() => {}} isInvalid>
      <TextInput
        id="input-error"
        labelText="Item Search"
        type={TextInputTypes.text}
        placeholder="Item Search"
      />
      <Button
        buttonType={ButtonTypes.Primary}
        id="button-error-state"
        type="submit"
      >
        <Icon
          name={IconNames.search}
          decorative={true}
          modifiers={["small", "icon-left"]}
        />
        Search
      </Button>
      <HelperErrorText id="error-helperText">
        Sorry, we can't find that item!
      </HelperErrorText>
    </SearchBar>
  </DSProvider>
</Canvas>

<br />

### Disabled State

For the disabled state, make sure to pass the `disabled` prop to the
`Button` component.

<Canvas>
  <DSProvider>
    <SearchBar obSubmit={() => {}} isDisabled>
      <TextInput
        id="input-disabled"
        placeholder="Item Search"
        type={TextInputTypes.text}
        isDisabled
        showLabel={true}
      />
      <Button
        buttonType={ButtonTypes.Primary}
        id="button-disabled"
        type="submit"
      >
        <Icon
          name={IconNames.search}
          decorative={true}
          modifiers={["small", "icon-left"]}
        />
        Search
      </Button>
      <HelperErrorText id="error-disabled">
        Reason for disabled state.
      </HelperErrorText>
    </SearchBar>
  </DSProvider>
</Canvas>
