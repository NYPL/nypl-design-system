import{r as l,R as Ue}from"./index-f2bd0723.js";import{_}from"./extends-98964cd2.js";import{_ as We}from"./index-fb519959.js";import{_ as Ge}from"./inheritsLoose-d541526f.js";import{_ as qe}from"./defineProperty-f749b14d.js";import{ai as $e,A as He}from"./chakra-ui-layout.esm-b2fa9d31.js";function Ve(e,r){if(e==null)return{};var n={},t=Object.keys(e),u,o;for(o=0;o<t.length;o++)u=t[o],!(r.indexOf(u)>=0)&&(n[u]=e[u]);return n}var L="data-focus-lock",ue="data-focus-lock-disabled",je="data-no-focus-lock",Ke="data-autofocus-inside";function Qe(e,r){return typeof e=="function"?e(r):e&&(e.current=r),e}function Ye(e,r){var n=l.useState(function(){return{value:e,callback:r,facade:{get current(){return n.value},set current(t){var u=n.value;u!==t&&(n.value=t,n.callback(t,u))}}}})[0];return n.callback=r,n.facade}function ze(e,r){return Ye(r||null,function(n){return e.forEach(function(t){return Qe(t,n)})})}var P={width:"1px",height:"0px",padding:0,overflow:"hidden",position:"fixed",top:"1px",left:"1px"};function ae(e){return e}function oe(e,r){r===void 0&&(r=ae);var n=[],t=!1,u={read:function(){if(t)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return n.length?n[n.length-1]:e},useMedium:function(o){var a=r(o,t);return n.push(a),function(){n=n.filter(function(i){return i!==a})}},assignSyncMedium:function(o){for(t=!0;n.length;){var a=n;n=[],a.forEach(o)}n={push:function(i){return o(i)},filter:function(){return n}}},assignMedium:function(o){t=!0;var a=[];if(n.length){var i=n;n=[],i.forEach(o),a=n}var f=function(){var s=a;a=[],s.forEach(o)},c=function(){return Promise.resolve().then(f)};c(),n={push:function(s){a.push(s),c()},filter:function(s){return a=a.filter(s),n}}}};return u}function G(e,r){return r===void 0&&(r=ae),oe(e,r)}function Je(e){e===void 0&&(e={});var r=oe(null);return r.options=We({async:!0,ssr:!1},e),r}var ie=G({},function(e){var r=e.target,n=e.currentTarget;return{target:r,currentTarget:n}}),ce=G(),Xe=G(),Ze=Je({async:!0}),er=[],q=l.forwardRef(function(r,n){var t,u=l.useState(),o=u[0],a=u[1],i=l.useRef(),f=l.useRef(!1),c=l.useRef(null),s=r.children,d=r.disabled,m=r.noFocusGuards,h=r.persistentFocus,v=r.crossFrame,b=r.autoFocus;r.allowTextSelection;var p=r.group,O=r.className,Ie=r.whiteList,Y=r.shards,Oe=Y===void 0?er:Y,z=r.as,Te=z===void 0?"div":z,J=r.lockProps,Se=J===void 0?{}:J,ke=r.sideCar,T=r.returnFocus,C=r.onActivation,N=r.onDeactivation,Ae=l.useState({}),Ce=Ae[0],Ne=l.useCallback(function(){c.current=c.current||document&&document.activeElement,i.current&&C&&C(i.current),f.current=!0},[C]),Pe=l.useCallback(function(){f.current=!1,N&&N(i.current)},[N]),De=l.useCallback(function(g){var S=c.current;if(T&&S&&S.focus){var Z=typeof T=="object"?T:void 0;c.current=null,g?Promise.resolve().then(function(){return S.focus(Z)}):S.focus(Z)}},[T]),we=l.useCallback(function(g){f.current&&ie.useMedium(g)},[]),Me=ce.useMedium,_e=l.useCallback(function(g){i.current!==g&&(i.current=g,a(g))},[]),Le=_((t={},t[ue]=d&&"disabled",t[L]=p,t),Se),X=m!==!0,Re=X&&m!=="tail",Be=ze([n,_e]);return l.createElement(l.Fragment,null,X&&[l.createElement("div",{key:"guard-first","data-focus-guard":!0,tabIndex:d?-1:0,style:P}),l.createElement("div",{key:"guard-nearest","data-focus-guard":!0,tabIndex:d?-1:1,style:P})],!d&&l.createElement(ke,{id:Ce,sideCar:Ze,observed:o,disabled:d,persistentFocus:h,crossFrame:v,autoFocus:b,whiteList:Ie,shards:Oe,onActivation:Ne,onDeactivation:Pe,returnFocus:De}),l.createElement(Te,_({ref:Be},Le,{className:O,onBlur:Me,onFocus:we}),s),Re&&l.createElement("div",{"data-focus-guard":!0,tabIndex:d?-1:0,style:P}))});q.propTypes={};q.defaultProps={children:void 0,disabled:!1,returnFocus:!1,noFocusGuards:!1,autoFocus:!0,persistentFocus:!1,crossFrame:!0,allowTextSelection:void 0,group:void 0,className:void 0,whiteList:void 0,shards:void 0,as:"div",lockProps:{},onActivation:void 0,onDeactivation:void 0};const fe=q;function rr(e,r){function n(t){return t.displayName||t.name||"Component"}return function(u){var o=[],a;function i(){a=e(o.map(function(c){return c.props})),r(a)}var f=function(c){Ge(s,c);function s(){return c.apply(this,arguments)||this}s.peek=function(){return a};var d=s.prototype;return d.componentDidMount=function(){o.push(this),i()},d.componentDidUpdate=function(){i()},d.componentWillUnmount=function(){var h=o.indexOf(this);o.splice(h,1),i()},d.render=function(){return Ue.createElement(u,this.props)},s}(l.PureComponent);return qe(f,"displayName","SideEffect("+n(u)+")"),f}}var F=function(e){for(var r=Array(e.length),n=0;n<e.length;++n)r[n]=e[n];return r},R=function(e){return Array.isArray(e)?e:[e]},nr=function(e){for(var r=new Set,n=e.length,t=0;t<n;t+=1)for(var u=t+1;u<n;u+=1){var o=e[t].compareDocumentPosition(e[u]);(o&Node.DOCUMENT_POSITION_CONTAINED_BY)>0&&r.add(u),(o&Node.DOCUMENT_POSITION_CONTAINS)>0&&r.add(t)}return e.filter(function(a,i){return!r.has(i)})},se=function(e){return e.parentNode?se(e.parentNode):e},$=function(e){var r=R(e);return r.filter(Boolean).reduce(function(n,t){var u=t.getAttribute(L);return n.push.apply(n,u?nr(F(se(t).querySelectorAll("["+L+'="'+u+'"]:not(['+ue+'="disabled"])'))):[t]),n},[])},tr=function(e){if(e.nodeType!==Node.ELEMENT_NODE)return!1;var r=window.getComputedStyle(e,null);return!r||!r.getPropertyValue?!1:r.getPropertyValue("display")==="none"||r.getPropertyValue("visibility")==="hidden"},ur=function(e,r){return!e||e===document||e&&e.nodeType===Node.DOCUMENT_NODE||!tr(e)&&r(e.parentNode&&e.parentNode.nodeType===Node.DOCUMENT_FRAGMENT_NODE?e.parentNode.host:e.parentNode)},de=function(e,r){var n=e.get(r);if(n!==void 0)return n;var t=ur(r,de.bind(void 0,e));return e.set(r,t),t},ar=function(e){return!((e.tagName==="INPUT"||e.tagName==="BUTTON")&&(e.type==="hidden"||e.disabled))},H=function(e){return!!(e&&e.dataset&&e.dataset.focusGuard)},k=function(e){return!H(e)},or=function(e){return!!e},ir=function(e,r){var n=e.tabIndex-r.tabIndex,t=e.index-r.index;if(n){if(!e.tabIndex)return 1;if(!r.tabIndex)return-1}return n||t},le=function(e,r,n){return F(e).map(function(t,u){return{node:t,index:u,tabIndex:n&&t.tabIndex===-1?(t.dataset||{}).focusGuard?0:-1:t.tabIndex}}).filter(function(t){return!r||t.tabIndex>=0}).sort(ir)},cr=["button:enabled","select:enabled","textarea:enabled","input:enabled","a[href]","area[href]","summary","iframe","object","embed","audio[controls]","video[controls]","[tabindex]","[contenteditable]","[autofocus]"],B=cr.join(","),fr=B+", [data-focus-guard]",V=function(e,r){return e.reduce(function(n,t){return n.concat(F(t.querySelectorAll(r?fr:B)),t.parentNode?F(t.parentNode.querySelectorAll(B)).filter(function(u){return u===t}):[])},[])},sr=function(e){var r=e.querySelectorAll("["+Ke+"]");return F(r).map(function(n){return V([n])}).reduce(function(n,t){return n.concat(t)},[])},j=function(e,r){return F(e).filter(function(n){return de(r,n)}).filter(function(n){return ar(n)})},U=function(e,r,n){return le(j(V(e,n),r),!0,n)},ee=function(e,r){return le(j(V(e),r),!1)},dr=function(e,r){return j(sr(e),r)},W=function(e,r){return r===void 0&&(r=[]),r.push(e),e.parentNode&&W(e.parentNode,r),r},D=function(e,r){for(var n=W(e),t=W(r),u=0;u<n.length;u+=1){var o=n[u];if(t.indexOf(o)>=0)return o}return!1},ve=function(e,r,n){var t=R(e),u=R(r),o=t[0],a=!1;return u.filter(Boolean).forEach(function(i){a=D(a||i,i)||a,n.filter(Boolean).forEach(function(f){var c=D(o,f);c&&(!a||c.contains(a)?a=c:a=D(c,a))})}),a},lr=function(e,r){return e.reduce(function(n,t){return n.concat(dr(t,r))},[])},vr=function(e){var r=$(e).filter(k),n=ve(e,e,r),t=new Map,u=U([n],t,!0),o=U(r,t).filter(function(a){var i=a.node;return k(i)}).map(function(a){var i=a.node;return i});return u.map(function(a){var i=a.node,f=a.index;return{node:i,index:f,lockItem:o.indexOf(i)>=0,guard:H(i)}})},mr=function(e){return e===document.activeElement},hr=function(e){return!!F(e.querySelectorAll("iframe")).some(function(r){return mr(r)})},me=function(e){var r=document&&document.activeElement;return!r||r.dataset&&r.dataset.focusGuard?!1:$(e).reduce(function(n,t){return n||t.contains(r)||hr(t)},!1)},br=function(){return document&&F(document.querySelectorAll("["+je+"]")).some(function(e){return e.contains(document.activeElement)})},he=function(e){return e.tagName==="INPUT"&&e.type==="radio"},Fr=function(e,r){return r.filter(he).filter(function(n){return n.name===e.name}).filter(function(n){return n.checked})[0]||e},K=function(e,r){return he(e)&&e.name?Fr(e,r):e},gr=function(e){var r=new Set;return e.forEach(function(n){return r.add(K(n,e))}),e.filter(function(n){return r.has(n)})},re=function(e){return e[0]&&e.length>1?K(e[0],e):e[0]},ne=function(e,r){return e.length>1?e.indexOf(K(e[r],e)):r},be="NEW_FOCUS",pr=function(e,r,n,t){var u=e.length,o=e[0],a=e[u-1],i=H(n);if(!(e.indexOf(n)>=0)){var f=r.indexOf(n),c=t?r.indexOf(t):f,s=t?e.indexOf(t):-1,d=f-c,m=r.indexOf(o),h=r.indexOf(a),v=gr(r),b=v.indexOf(n)-(t?v.indexOf(t):f),p=ne(e,0),O=ne(e,u-1);if(f===-1||s===-1)return be;if(!d&&s>=0)return s;if(f<=m&&i&&Math.abs(d)>1)return O;if(f>=h&&i&&Math.abs(d)>1)return p;if(d&&Math.abs(b)>1)return s;if(f<=m)return O;if(f>h)return p;if(d)return Math.abs(d)>1?s:(u+s+d)%u}},yr=function(e){return function(r){return r.autofocus||r.dataset&&!!r.dataset.autofocus||e.indexOf(r)>=0}},Er=function(e,r){var n=new Map;return r.forEach(function(t){return n.set(t.node,t)}),e.map(function(t){return n.get(t)}).filter(or)},xr=function(e,r){var n=document&&document.activeElement,t=$(e).filter(k),u=ve(n||e,e,t),o=new Map,a=ee(t,o),i=U(t,o).filter(function(h){var v=h.node;return k(v)});if(!(!i[0]&&(i=a,!i[0]))){var f=ee([u],o).map(function(h){var v=h.node;return v}),c=Er(f,i),s=c.map(function(h){var v=h.node;return v}),d=pr(s,f,n,r);if(d===be){var m=a.map(function(h){var v=h.node;return v}).filter(yr(lr(t,o)));return{node:m&&m.length?re(m):re(s)}}return d===void 0?d:c[d]}},Ir=function(e){e.focus(),"contentWindow"in e&&e.contentWindow&&e.contentWindow.focus()},w=0,M=!1,Fe=function(e,r){var n=xr(e,r);if(!M&&n){if(w>2){console.error("FocusLock: focus-fighting detected. Only one focus management system could be active. See https://github.com/theKashey/focus-lock/#focus-fighting"),M=!0,setTimeout(function(){M=!1},1);return}w++,Ir(n.node),w--}};function ge(e){var r=window,n=r.setImmediate;typeof n<"u"?n(e):setTimeout(e,1)}var Or=function(){return document&&document.activeElement===document.body},Tr=function(){return Or()||br()},E=null,y=null,x=null,I=!1,Sr=function(){return!0},kr=function(r){return(E.whiteList||Sr)(r)},Ar=function(r,n){x={observerNode:r,portaledElement:n}},Cr=function(r){return x&&x.portaledElement===r};function te(e,r,n,t){var u=null,o=e;do{var a=t[o];if(a.guard)a.node.dataset.focusAutoGuard&&(u=a);else if(a.lockItem){if(o!==e)return;u=null}else break}while((o+=n)!==r);u&&(u.node.tabIndex=0)}var Nr=function(r){return r&&"current"in r?r.current:r},Pr=function(r){return r?!!I:I==="meanwhile"},A=function(){var r=!1;if(E){var n=E,t=n.observed,u=n.persistentFocus,o=n.autoFocus,a=n.shards,i=n.crossFrame,f=t||x&&x.portaledElement,c=document&&document.activeElement;if(f){var s=[f].concat(a.map(Nr).filter(Boolean));if((!c||kr(c))&&(u||Pr(i)||!Tr()||!y&&o)&&(f&&!(me(s)||Cr(c))&&(document&&!y&&c&&!o?(c.blur&&c.blur(),document.body.focus()):(r=Fe(s,y),x={})),I=!1,y=document&&document.activeElement),document){var d=document&&document.activeElement,m=vr(s),h=m.map(function(v){var b=v.node;return b}).indexOf(d);h>-1&&(m.filter(function(v){var b=v.guard,p=v.node;return b&&p.dataset.focusAutoGuard}).forEach(function(v){var b=v.node;return b.removeAttribute("tabIndex")}),te(h,m.length,1,m),te(h,-1,-1,m))}}}return r},pe=function(r){A()&&r&&(r.stopPropagation(),r.preventDefault())},Q=function(){return ge(A)},Dr=function(r){var n=r.target,t=r.currentTarget;t.contains(n)||Ar(t,n)},wr=function(){return null},ye=function(){I="just",setTimeout(function(){I="meanwhile"},0)},Mr=function(){document.addEventListener("focusin",pe,!0),document.addEventListener("focusout",Q),window.addEventListener("blur",ye)},_r=function(){document.removeEventListener("focusin",pe,!0),document.removeEventListener("focusout",Q),window.removeEventListener("blur",ye)};function Lr(e){return e.filter(function(r){var n=r.disabled;return!n})}function Rr(e){var r=e.slice(-1)[0];r&&!E&&Mr();var n=E,t=n&&r&&r.id===n.id;E=r,n&&!t&&(n.onDeactivation(),e.filter(function(u){var o=u.id;return o===n.id}).length||n.returnFocus(!r)),r?(y=null,(!t||n.observed!==r.observed)&&r.onActivation(),A(),ge(A)):(_r(),y=null)}ie.assignSyncMedium(Dr);ce.assignMedium(Q);Xe.assignMedium(function(e){return e({moveFocusInside:Fe,focusInside:me})});const Br=rr(Lr,Rr)(wr);var Ee=l.forwardRef(function(r,n){return l.createElement(fe,_({sideCar:Br,ref:n},r))}),xe=fe.propTypes||{};xe.sideCar;Ve(xe,["sideCar"]);Ee.propTypes={};const Ur=Ee;var jr=function(r){var n=r.initialFocusRef,t=r.finalFocusRef,u=r.contentRef,o=r.restoreFocus,a=r.children,i=r.isDisabled,f=r.autoFocus,c=r.persistentFocus,s=r.lockFocusAcrossFrames,d=l.useCallback(function(){if(n!=null&&n.current)n.current.focus();else if(u!=null&&u.current){var v=$e(u.current);v.length===0&&He(u.current,{nextTick:!0})}},[n,u]),m=l.useCallback(function(){var v;t==null||(v=t.current)==null||v.focus()},[t]),h=o&&!t;return l.createElement(Ur,{crossFrame:s,persistentFocus:c,autoFocus:f,disabled:i,onActivation:d,onDeactivation:m,returnFocus:h},a)};export{jr as F,Ve as _,Je as c,ze as u};
//# sourceMappingURL=chakra-ui-focus-lock.esm-eb172e6c.js.map
